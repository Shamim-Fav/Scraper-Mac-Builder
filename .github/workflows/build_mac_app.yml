name: Mac App Builder (PyInstaller)

on:
  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:

jobs:
  build-mac:
    runs-on: macos-latest  # Use the macOS virtual environment

    steps:
    - name: 1. Checkout Code
      uses: actions/checkout@v4

    - name: 2. Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.10'

    - name: 3. Install Dependencies
      run: |
        python -m pip install --upgrade pip
        # These are the libraries needed for your script
        pip install pyinstaller undetected-chromedriver selenium pandas
        
    - name: 4. Run PyInstaller Build
      run: |
        # Creates the WSP Scraper.app bundle in the 'dist' folder
        pyinstaller --onefile --windowed --name "WSP Scraper" scraper_gui.py
      
    - name: 5. Install DMG Utility (create-dmg)
      # Homebrew is used to install the command-line tool needed for professional DMG creation
      run: brew install create-dmg

    - name: 6. Create the Final DMG Installer (FIXED: Background removed)
      run: |
        # This command creates a professional .dmg installer with the drag-and-drop experience.
        create-dmg \
          --volname "WSP Scraper Installer" \
          --window-size 500 300 \
          --icon-size 100 \
          --app-drop-link 370 140 \
          --icon "WSP Scraper.app" 130 140 \
          "dist/WSP_Scraper_Installer.dmg" \
          "dist/WSP Scraper.app"
          
    - name: 7. Upload the DMG Application (Artifact)
      uses: actions/upload-artifact@v4
      with:
        name: macos-scraper-installer
        path: dist/WSP_Scraper_Installer.dmg
        retention-days: 7
